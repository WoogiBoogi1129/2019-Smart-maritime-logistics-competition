# 한이음 공모전 _ 2019 스마트 해상물류 프로젝트 경진대회

## [2019 스마트 해상물류 프로젝트 경진대회] 5G를 이용한 울산항 안전운항 시뮬레이션 ( **참고 : 아래 설명은 필자가 개발한 부분 위주로 설명했습니다.** )

## 과제 개요

**작품 소개**

1. 시뮬레이션과 시뮬레이션 조종기
    
    ![7](https://user-images.githubusercontent.com/47939832/112260023-90690f80-8cac-11eb-82d6-de04dd84465a.png)

2. 드론과 드론 운항 모습
    
    ![8](https://user-images.githubusercontent.com/47939832/112260029-93640000-8cac-11eb-913a-894af4ea2381.png)
    
    ![9](https://user-images.githubusercontent.com/47939832/112260036-952dc380-8cac-11eb-9832-16f0194d88d5.png)

3. 서버 화면
    
    ![10](https://user-images.githubusercontent.com/47939832/112260044-97901d80-8cac-11eb-8ae3-47d89a73759b.png)

4. 조종기앱, 제어부 앱 화면
    
    ![11](https://user-images.githubusercontent.com/47939832/112260050-9959e100-8cac-11eb-9328-cd7c30687240.png)
    
    ![12](https://user-images.githubusercontent.com/47939832/112260052-99f27780-8cac-11eb-937d-19c8cd72310f.png)
    
    ![13](https://user-images.githubusercontent.com/47939832/112260059-9ced6800-8cac-11eb-84ce-af5149906749.png)

- 5G + 위치센서 + 원격조정 + 수상드론 + 게임의 조합으로 선박 안전운항 시뮬레이션 개발
- 시뮬레이터 구축 후 소형선박 운항자 대상 안전교육 가능(상대적으로 작은 선박의 사고율이 높고 큰 선박은 사고율이 낮음)
- 5G 센서 모듈의 실제선박 부착: 수상드론의 스마트폰 탑재 후 스마트폰에 서 5G 및 GPS를 활용한 초저지연으로 안전관리 가능
- 시뮬레이터와 수상 드론, 관제센터의 구축으로 울산항 내부의 입출항 배의 항로 궤적 확인 파악

**작품 구성도**

    ![1](https://user-images.githubusercontent.com/47939832/111901995-7c3fcb00-8a7e-11eb-843e-fdccf836ce35.png)
    

- 작품의 특징 및 장점
    
    - 시뮬레이션
        
        - 바다와 배의 동작은 기존의 오픈소스를 활용하여 우리 프로젝트에 맞게 수정 및 변경, 함수 추가 등으로 제작
        
        - 시뮬레이션 내부의 일어나는 동작은 마우스의 커서 좌표와 블루프린트를 통한 애셋의 움직임, 레벨단위의 map 제작 을 진행
        
        -  실제 시뮬레이션을 하기 위한 배의 타기와 속도 조절 레버를 실제로 구현 하였는데 가격적인 측면에서 다른 조종기에 비해 저렴
        
        - 가격도 가격이지만 아두이노를 활용하였기에 부가적인 기능의 확장 가능성이 용이함
        
        - 국내의 제한적인 항만 시뮬레이션에서 상대적으로 쉬우면서 저렴한 시뮬레이션의 등장이라고 할 수 있음
        
        - 누구나 쉽게 어렵지 않게 실제 배의 움직임을 간접적으로 체험 할 수 있음
        
        - 자이로 센서를 활용해 실제의 각도와 배의 타각과 매핑 또한 배의 속도의 단수 만큼 레버의 단 수 구현 하여 CPS를 이루어 냈다고 할 수 있음
        
        - 전반적으로 시뮬레이션은 비슷한 기능을 보여주면서 부가기능 + 덧 붙여진 재료의 조합이 다른 시뮬레이션에 비해 저가라는 사실을 어필 할 수 있음
        
    - 수상 드론
      
        - 앱을 통한 조종으로 사용자가 쉽게 수상 드론을 조작 할 수 있음
        
        - LTE에서 인터페이스를 구축 하였기에 추후 5G로 확장 가능성이 존재
        
        - 수상 드론은 실제 배의 타각에 따른 회전을 똑같이 구현 하였기에 CPS를 이루어 냈다고 할 수 있음
        
        - 라즈베리 파이가 주 MCU로 동작하기 때문에 추후 다른 센서, 모듈의 연결로 확장 가능성이 용이하다고 할 수 있음 
        
        - 드론의 외형 소재, 내부에 들어가는 소자들을 생각 했을 때 기존의 출시된 다른 수상 드론에 비해 무게가 가볍고 가격적인 측면에서 저렴함
        
        - 구축된 서버와 통신이 가능하여 사용자가 앱을 통해 조종하는 것이 아닌 관제센터에서 관리가 가능
        
        - 또한 실제 배에 탑재되어 VTS관제 시스템도 있겠지만 안전장치의 기능을 추가 할 수 있음
        
        - 안전장치의 추가라는 것은 수상 드론에 부착 되어있는 GPS 정보가 될 수 있고 비상 연락망이 될 수도 있고(LTE 인터페이스를 구축하기위해 스마트폰이 드론에 탑재된 형태) 더 얼마나 확장 하느냐에 따라 각기 다른 기능을 보여줄 것으로 예상

## 적용 기술

- 5G를 이용한 GPS 정밀 관리 (오차: 1m이내, 경신: ms까지 조절가능)

- 실제 환경과 비슷한 시뮬레이션, 인터넷을 통한 실시간 수상 드론 제어

- 5G / LTE / WiFi 무선 네트워크를 통한 네트워크 제어

- 수상 드론의 기획/개발/운용

- 스마트 폰을 연동한 물리적 도구(타기, 수상 드론) 제어

- Open Source H/W (Arduino, Raspberry Pi)

- Open Source S/W (운항 시뮬레이션, Unreal Engine, Google Map API)

### 서버와 앱

![2](https://user-images.githubusercontent.com/47939832/111902193-7dbdc300-8a7f-11eb-82d2-ef7b8e1eb8b2.png)
  
    초반 앱과 앱을 통신하기 위해 제어부 앱 측에서 핫스팟을 열어줘야 TCP/IP 통신을 통해 드론을 제어했습니다. 하지만 우리 프로젝트는 5G를 이용해 통신을 해야 했었고 고정 IP를 이용해 5G를 구현하기에는 한계가 있었습니다. 5G를 사용하기 위해서는 우선 LTE 통신을 이용해 앱과 앱의 data를 주고받을 필요가 있었습니다. 이를 위한 해결책으로 직접 서버를 만들어 서로 다른 2개의 앱을 서버에 접속시켜 서버를 통해 값을 주고받는 방법을 생각해냈습니다.
    
    드론과 연결될 앱과 드론을 조종할 앱 2개가 존재합니다. 앱과 앱은 LTE 더나아가 5G 환경을 통해 통신합니다. 아래 과정은 APP간의 통신을 위한 과정입니다.
    
    1. 인터넷을 통한 상호 교환을 위해 서버를 구축해야 합니다. 그러기 위해 KT 홈 AP를 이용 하여 서버가 될 노트북의 내부 아이피를 할당
    2. 내부 아이피를 할당받은 노트북에서 WAS를 통해 로컬서버를 오픈하고 그 위에 웹소켓을 실행해줄 서버 페이지를 JSP, 자바스크립트, 자바로 구성
    3. 이후 로컬서버를 실행하여 JSP페이지를 구동
    4. DDNS를 위한 URL을 하나 할당받고 이 URL을 DDNS서버를 통해 외부 아이피와 URL을 매핑
    5. DNS를 위한 URL을 할당 받고 DNS 서버를 통해 내부 아이피와 URL을 매핑
    6. KT 홈 관리자를 통해 외부아이피와 내부 아이피 간의 포트포워딩
    7. 조종기 앱과 드론에 동작할 앱이 DDNS에 등록된 URL에 덧붙여 로컬서버를 통한 JSP페이지까지의 위치를 덧붙여 접속
    8. 앱에서 JSP페이지까지 가게 되면 안에 구현해놓은 자바스크립트 함수 및 자바 함수에 따라 양방향 간의 소켓통신
    9. 각각의 소켓통신으로 얻은 데이터는 각각 해당되는 부분에 맞게 파싱되고 처리

### 조종기 앱

![3](https://user-images.githubusercontent.com/47939832/111902354-7c40ca80-8a80-11eb-8b58-de56caf5bbd2.png)

- background : 선박 조타실 내부의 모습과 비슷한 이미지
- 휠의 기능 : 스마트폰의 기울기 센서 값을 통해 휠의 이미지가 회전하며 회전한 값에 따라 드론의 회전 각도를 구현
- progress bar : 스마트폰의 기울기 값에 따라 게이지 증감소
- GPS : 사용자에게 드론의 현재 위치를 알려주기 위해 GPS View 또한 구성

### 수신기 앱

![4](https://user-images.githubusercontent.com/47939832/111902556-64b61180-8a81-11eb-8d71-b290d8b8a07f.png)

- background : 드론에 실릴 스마트폰으로써 배경 이미지는 실제 드론이 동작될 환경에 맞춰 바다 이미지를 선택
- 인터넷 연결 버튼 : 구름 모양의 이미지는 버튼 기능을 합니다. 이는 인터넷과 연결되어 조종기 앱으로부터 드론의 방향과 속도 값을 받을 수 있게 합니다. 또한, 배경 이미지에 어울리도록 구름 이미지로 디자인했습니다.
- GPS : 수상드론의 위치를 조종기 앱으로 송신 및 가시화

### 시뮬레이션 알고리즘 제작

![6](https://user-images.githubusercontent.com/47939832/111902869-cd51be00-8a82-11eb-86e7-0bb1c6d1c3dd.png)

- 시뮬레이션 전체 흐름도
    
    - 플로우 차트
    
        ![5](https://user-images.githubusercontent.com/47939832/111902780-6207ec00-8a82-11eb-9456-a47cb267cf06.png)
        
        시뮬레이션은 크게 3개의 액션으로 구성되어 있고 위 흐름을 따른다. 
        
        1. 메인 : 시뮬레이션 프로그램 실행 시 화면에 처음 보여지는 화면(figure 2)이다. 바다에 선박이 떠있는 모습이 백그라운드 영상으로 재생되고 우측에는 ‘시작’, ‘종료’ 버튼 UI로 구성된다. 
        2. 시뮬레이션 환경설정 : 시뮬레이션을 플레이 하기 전 사용자가 시뮬레이트 할 환경을 설정하는 화면으로 [ 배 선택 – 부두 선택 – 입,출항 선택 – 자유,자동항해 선택 ] 의 4단계로 구성되어 있다. 메인 화면에서 ‘시작’ 버튼을 누르면 뒤이어 설정화면이 나온다. 설정단계에서 3단계까지 모두 선택했다면 선택한 옵션으로 시뮬레이션을 시작하게 된다.
        3. 플레이 : 환경설정에서 선택한 옵션으로 시뮬레이션이 시작되고 사용자가 조타기와 레버를 이용하여 배를 조종하며 운항해볼 수 있다.
        4. 도착 : 목적지에 도착하게 되면 도착이라는 텍스트와 함께 ‘처음으로’, ‘다시하기’ 버튼 UI가 생성되어 사용자가 시뮬레이션을 계속 진행할 수 있게 한다.
        
        ![14](https://user-images.githubusercontent.com/47939832/112263073-0b80f480-8cb2-11eb-9a25-ffd73564a859.png)
        
        1. 마우스 좌표값에 따라 특정 좌표값을 넘어가면, 원하는 setting 버튼을 선택할 수 있게 알고리즘을 구성
        2. 마우스 좌측 -> 메뉴 선택
        3. 마우스 우측 -> 이전 환경설정 화면
        
- 알고리즘 구성에 따른 화면 구성
    
    ![15](https://user-images.githubusercontent.com/47939832/112263808-3d468b00-8cb3-11eb-97ac-9e5477548284.png)
    
    ![16](https://user-images.githubusercontent.com/47939832/112263820-40417b80-8cb3-11eb-8803-60ddb2061793.png)
    
    ![17](https://user-images.githubusercontent.com/47939832/112263824-42a3d580-8cb3-11eb-802a-9bd69287eb0c.png)
    
    ![18](https://user-images.githubusercontent.com/47939832/112263829-446d9900-8cb3-11eb-86dd-204fb457e77c.png)
        
